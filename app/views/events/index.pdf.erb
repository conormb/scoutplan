<% current_year = 0 %>
<% current_col = 0 %>

<h1 style="margin-bottom:3rem;">
  <%= @unit.name %>
  Event Calendar
  <%= events_by_month.keys.first.first %>
  &ndash;
  <%= events_by_month.keys.last.first %>
</h1>

<table style="width:100%;">
  <tr>
    <% events_by_month.each do |year_and_month, events|  %>
      
      <% year = year_and_month.first %>
      <% month = year_and_month.second %>

      <td valign="top" style="width:33%;">

        <%# month name and (sometimes) year %>
        <h2>
          <%= Date::MONTHNAMES[month] %>
      
          <% if current_year != year %>
            <% current_year = year %>
            <%= current_year %>
          <% end %>          
        </h2>

        <table style="width:100%;">
          <% events.each do |event| %>
            <tr>
              <td valign="top" style="padding: 1rem 1rem 1rem 0;">
                <div style="font-size:200%;"><%= event.starts_at.strftime("%d") %></div>
                <div style="font-weight:bold;"><%= event.starts_at.strftime("%a") %></div>
              </td>

              <td valign="top" style="padding: 1rem 0;">
                <div style="font-weight:bold; font-size:1.25rem; line-height:1.25;"><%= event.title %></div>
                <div><%= event.location %></div>
              </td>
            </tr>
          <% end # each event %>
        </table>
      </td>

      <%# perform column wrapping %>
      <% current_col += 1 %>
      <% if current_col > 2 %>
        </tr><tr>
        <% current_col = 0 %>
      <% end %>

    <% end # each month  %>
    </tr>
</table>

<style>
  h1 {
    margin-bottom: 12rem;
  }
</style>