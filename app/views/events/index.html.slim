= render 'events/partials/index/header'

main
  = render partial: 'events/partials/index/no_events' if @events.count.zero?
  = render partial: 'events/partials/index/table' if @events.count.positive?

- content_for :body_classes do
  = "events index"
  = " events-filtered showing-only-rsvp-events" if session[:view] == 'rsvps'

- content_for :head do
  = stylesheet_link_tag unit_path(@unit, format: :css)

= render 'events/partials/event_form'

javascript:
  // wire up the bulk Publish button
  document.querySelector('#bulk_publish_execute_button').addEventListener('click', function(event) {
    document.querySelector('#bulk_action_form').submit();
    event.preventDefault();
  });

  // wire up the check/uncheck all box
  document.querySelector('#select_all_events_checkbox').addEventListener('click', function(event) {
    const checked = this.checked;
    document.querySelectorAll('.bulk-publish-checkbox').forEach(function (elem) {
        elem.checked = checked && elem.offsetParent !== null;
    });
    validateBulkPublishState();
  });

  // wire up Cancel bulk publish button
  document.querySelector('#cancel_bulk_publish').addEventListener('click', function(event) {
    document.body.classList.toggle('showing-only-draft-events');
    document.body.classList.toggle('events-filtered');
    event.preventDefault();
  });

  const bulkPublishExecuteButton = document.querySelector('#bulk_publish_execute_button');
  const originalBulkPublishExecuteButtonCaption = bulkPublishExecuteButton.value;

  // wire up event row checkboxes
  document.querySelectorAll('.bulk-publish-checkbox').forEach(function(elem) {
    elem.addEventListener('click', function(event) {
      validateBulkPublishState();
    });
  });

  function validateBulkPublishState() {
    // tally up checked count
    const checkedCount = document.querySelectorAll('td.selection input:checked').length;

    // enable execute button
    bulkPublishExecuteButton.disabled = (checkedCount == 0);

    // update execute button caption
    bulkPublishExecuteButton.value = originalBulkPublishExecuteButtonCaption + (checkedCount == 0 ? '' : ' (' + checkedCount + ')');
  }

  document.querySelectorAll('.toggle-body-class').forEach(function(elem) {
    elem.addEventListener('click', function(event) {
      const classNames = this.dataset.bodyClass.split(' ');
      for(const className of classNames) {
        document.body.classList.toggle(className);
      }
      event.preventDefault();
    });
  });

  // links inside clickable rows should take priority, so we stop
  // propagation on them
  var links = document.getElementsByClassName('event-rsvp-link');
  for (const link of links) {
    link.addEventListener('click', function(event) {
      event.stopPropagation();
    });
  }

  // also prevent checkboxes from firing clickable rows
  document.querySelectorAll('.selection input[type="checkbox"]').forEach(function (elem) {
    elem.addEventListener('click', function(event) {
      event.stopPropagation();
    });
  });

scss:
  body {
    font-size: 95%;
  }

  .start-day, .days, .title, .glyph {
    width: 1%;
    white-space: nowrap;
  }

  .event-month-boundary {
    font-weight: 700;
  }

  tr.no-hover:hover td {
    background-color: inherit !important;
  }

  .event-row {
    display: table-row;
    transition: height 2s ease;
  }

  .event-past, .event-cancelled, .event-future {
    display: none;
  }

  table.table row.event-past td {
    color: #aaa;
  }

  .event-past td {
    background: #f4f4f4;
    color: #888;
  }

  .filter-status {
    display: none;
    margin-top: -12px;
  }

  body.showing-cancelled-events {
    .event-cancelled {
      display: table-row;
    }

    #show-cancelled-events-link {
      .menu-glyph-wrapper {
        display: inline-block;
      }
    }
  }

  body.showing-only-rsvp-events {
    .event-row:not(.event-rsvp) {
      display: none;
    }

    #show-only-rsvp-events-link {
      .menu-glyph-wrapper {
        display: inline-block;
      }
    }

    .filter-status-only-rsvps {
      display: block;
    }
  }

  // Draft events / bulk publish

  th.selection, td.selection {
    display: none;
  }

  #bulk_publish_button_wrapper {
    display: none;
  }

  body.showing-only-draft-events {
    .event-row:not(.event-draft) {
      display: none;
    }

    #show-only-draft-events-link {
      .menu-glyph-wrapper {
        display: inline-block;
      }
    }

    th.selection, td.selection {
      display: table-cell;
    }

    #bulk_publish_button_wrapper {
      display: inline-block;
    }

    #add_event_button_wrapper {
      display: none;
    }
  }

  body.showing-past-events {
    .event-past {
      display: table-row;
    }

    #show-past-events-link {
      .menu-glyph-wrapper {
        display: inline-block;
      }
    }
  }

  body.showing-future-events {
    .event-future {
      display: table-row;
    }

    #show-future-events-wrapper {
      display: none;
    }
  }

  .event-rsvp-link {
    z-index: 1000;
  }

  .daynames {
    font-size: 0.75rem;
    padding-left: 2px;
    text-transform: uppercase;
    color: #888;
    font-weight: 600;
    baseline-shift: 0.125rem;
    color: rgb(128,128,128);
  }

  .table .start-day {
    padding-right: 2px;
  }

  .table .days {
    padding-left: 2px;
  }

  td.month {
    padding-top: 1rem;
    font-weight: bold;
  }

  tr.event {
    td.glyph {
      text-align: center;
    }
  }

  .action {
    text-align: right;
  }

  input[type="date"].error {
    background-color: #ffffcc;
    animation: shake 0.6s 0s;
  }

  @keyframes pulse-animation {
    0% {
      box-shadow: 0 0 0 0px rgba(0, 0, 0, 0.2);
    }
    100% {
      box-shadow: 0 0 0 20px rgba(0, 0, 0, 0);
    }
  }

  @keyframes wiggle {
     0% { transform: skewX(9deg); }
     10% { transform: skewX(-8deg); }
     20% { transform: skewX(7deg); }
     30% { transform: skewX(-6deg); }
     40% { transform: skewX(5deg); }
     50% { transform: skewX(-4deg); }
     60% { transform: skewX(3deg); }
     70% { transform: skewX(-2deg); }
     80% { transform: skewX(1deg); }
     90% { transform: skewX(0deg); }
     100% { transform: skewX(0deg); }
  }

  @keyframes shake {
   0%, 100% {transform: translateX(0);}
   10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);}
   20%, 40%, 60%, 80% {transform: translateX(5px);}
  }

  tr.event-camping {
    td:first-child {
      border-left-color: green;
    }

    .glyph svg {
      color: green;
    }
  }

  tr.court_of_honor-event {
    td:first-child {
      border-left-color: GoldenRod;
    }

    .glyph svg {
      color: GoldenRod;
    }
  }

  tr.event-troop_meeting {
    td:first-child {
      border-left-color: FireBrick;
    }

    .glyph svg {
      color: FireBrick;
    }
  }

  .rsvp-response svg {
    margin-right: 0.2rem;
    color: rgb(128, 128, 128);
  }

  .rsvp-accepted svg {
    color: green;
  }

  .rsvp-declined svg {
    color: red;
  }

  td.action {
    ul {
      list-style: none;
      margin: 0;
      padding: 1px 0 0 0;

      li {
        display: inline-block;
        padding: 0 0.5rem 0 0;
      }
    }

    a.btn {
      padding-top: 1px !important;
      padding-bottom: 1px !important;
      font-size: 90%;
    }
  }

  .table tr {
    border-color: rgb(240, 240, 240);

    td {
      padding-top: 10px;
      padding-bottom: 10px;
    }
  }

